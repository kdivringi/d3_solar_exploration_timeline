<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script type="text/javascript">
    function draw(locs) {
        	
      // Set scale & axis regions
      var margin = 75,
          width = 940 - margin,
          height = 700 - margin;

      // d3.select("body")
      //   .append("h2")
      //   .text("Timeline of Solar System Exploration");

      var svg = d3.select("#vis")
        .attr("width", width + margin)
        .attr("height", height + margin);

      // Draw Places / Year Scales

      var g = d3.select("svg")
        .append('g')
        .attr("class", "locs");

      g.selectAll("text")
        .data(locs)
        .enter()
        .append("text")
        .attr("y", function (d) {return +d['position']*height;})
        .text(function (d) {return d['name'];});
      
      var p_delta = 0.091;
      g.selectAll("rect.back")
        .data(locs)
        .enter()
        .append("rect")
        .attr("class", "back")
        .attr("x", margin)
        .attr("y", function (d) { 
          return +d['position']*height - 0.5*p_delta*height;
        })
        .attr("width", width - margin)
        .attr("height",p_delta*height)
        .style("fill", function (d) {return d['color'];})
        .style("opacity", 0.35);

      var loc_scale = d3.scale.ordinal()
        .domain(locs.map(function (d) {return d['name'];}))
        .range(locs.map(function (d) {return +d['position']*height;}));


      var time_scale = d3.scale.linear()
        .range([margin, width])
        .domain([1958, 2015]);

      var time_axis = d3.svg.axis()
        .scale(time_scale)
        .orient("bottom")
        .tickFormat(d3.format("04d"));


      // Function to draw mission path
      function draw_missions(data) {
        // debugger;

        // Draw trip section of path
          // Not if launch=arrival
          // Appropriate marker type
          // Stagger y for each mission on track

        var loop_limit = 12;
        var time_delta = time_scale(2001) - time_scale(2000);

        function calc_x_factor(i) {
          var mod = i % loop_limit;
          var x_factor = time_delta * mod/loop_limit - 0.5*time_delta;
          return x_factor;
        }

        function calc_y_factor(i) {
          var mod = i % loop_limit;
          var y_factor = p_delta*height * mod/loop_limit - 0.5*p_delta*height;
          return y_factor;
        }

        svg.append('g')
          .attr("class","mission")
          .selectAll("path.trip")
          .data(data)
          .enter()
          .append("path")
          .attr("class", "trip")
          .attr("stroke", "black")
          .attr("stroke-width", 1)
          .attr("stroke-dasharray", "5,5")
          .attr('d', function (d, i) {
            debugger;
            var x_factor = calc_x_factor(i)*0.9;
            var y_factor = calc_y_factor(i)*0.9;
            var x0 = time_scale(d['launch']); 
            var x1 = time_scale(d['arrival']);
            if (x0===x1) {
              return "";
            }

            var y0 = loc_scale("Earth") + y_factor;
            var y1 = loc_scale(d['destination']) + y_factor; 
            return "M" + x0 + " " + y0 + " L" + x1 + " " + y1;
          });

        d3.select("g.mission")
          .selectAll("path.activity")
          .data(data)
          .enter()
          .append("path")
          .attr("class", "activity")
          .attr("stroke", "black")
          .attr("stroke-width", 1)
          .attr("marker-end", "url(#Triangle)")
          .attr("d", function (d, i) {
            var x_factor = calc_x_factor(i)*0.9;
            var y_factor = calc_y_factor(i)*0.9;

            var x0 = time_scale(d['arrival']); 
            var x1 = time_scale(d['end']);
            var y0 = loc_scale(d['destination']) + y_factor;
            var y1 = loc_scale(d['destination']) + y_factor;
            return "M" + x0 + " " + y0 + " L" + x1 + " " + y1;
          });
      }

      d3.tsv("solar_exploration.tsv", draw_missions);

      svg.append('g')
        .attr('class', 'x axis')
        .attr('transform', "translate(0," + height + ")")
        .call(time_axis);
      // debugger;

      // Bind and draw everything

    	// Set Mouseover events

    	// Set button actions/transitions
    	
    }
      </script>
  </head>
<body>
  <div class="container">
  <div class="row">
    <h1>Timeline of Solar System Exploration</h1>
    <div class="span12">
      <svg id="vis">
            <defs>
              <marker id="Triangle"
                      viewBox="0 0 10 10" 
                      refX="1" refY="5"
                      markerWidth="6" 
                      markerHeight="6"
                      orient="auto">
                  <path d="M 0 0 L 10 5 L 0 10 z" />
              </marker>
            </defs>

      </svg>
    </div>
  </div>
  <div class="row">
    <div class="span3" id="planets">
      <h4>Destination</h4>
      <p>
        <a href="#" class="btn">Sun</a>
        <a href="#" class="btn">Mercury</a>
        <a href="#" class="btn">Venus</a>
        <a href="#" class="btn">Mars</a>
        <a href="#" class="btn">Asteroids</a>
        <a href="#" class="btn">Jupiter</a>
        <a href="#" class="btn">Saturn</a>
        <a href="#" class="btn">Comets</a>
        <a href="#" class="btn">Interplanetary Space</a>
        <a href="#" class="btn">Pluto</a>
      </p>
    </div>
    <div class="span3" id="years">
      <h4>Eras</h4>
    </div>
    <div class="span3" id="types">
      <h4>Mission Types</h4>
      <p>
        <a href="#" class="btn">flyby</a>
        <a href="#" class="btn">orbiter</a>
        <a href="#" class="btn">lander</a>
        <a href="#" class="btn">rover</a>
        <a href="#" class="btn">explorer</a>
        <a href="#" class="btn">impactor</a>
        <a href="#" class="btn">sample return</a>
        <a href="#" class="btn">telescope</a>
        <a href="#" class="btn">flyby,lander</a>
        <a href="#" class="btn">orbiter,lander</a>
        <a href="#" class="btn">orbiter,lander,rover</a>
      </p>
    </div>
    <div class="span3" id="efficiency">
      <h4>Mission Success</h4>
      <p>
        <a href="#" class="btn">True</a>
        <a href="#" class="btn">False</a>
      </p>
    </div>
  </div>
  </div>

  <script type="text/javascript">
  /*
    */
  d3.tsv("locations.tsv", draw);
  </script>
</body>
</html>
